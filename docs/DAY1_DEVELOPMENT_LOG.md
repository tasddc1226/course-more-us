# 코스모스 (Course-More-Us) - 1일차 개발 기록

> **개발 기간**: 2025년 06월 15일  
> **개발자**: yangsuyoung  
> **프로젝트**: 데이트 코스 추천 서비스 "코스모스"

## 📋 프로젝트 개요

**코스모스(Course-More-Us)**는 사용자의 선호도와 위치를 기반으로 맞춤형 데이트 코스를 추천해주는 웹 서비스입니다.

### 기술 스택
- **Frontend**: Remix (React), TypeScript, Tailwind CSS
- **Backend**: Remix Server Functions
- **Database**: Supabase (PostgreSQL)
- **Authentication**: Supabase Auth
- **Deployment**: 미정 (향후 Vercel 또는 Netlify 예정)

## 🚀 개발 단계별 진행 과정

### A 단계: 관리자 페이지 구현 ✅

#### 1. 프로젝트 초기 설정
- **Remix 프로젝트 생성** 및 기본 구조 설정
- **Supabase 연동** 및 환경 변수 설정
- **TypeScript 타입 정의** 생성 (`app/types/database.types.ts`)

#### 2. 데이터베이스 스키마 설계
```sql
-- 핵심 테이블 구조
- regions (지역)
- categories (카테고리) 
- time_slots (시간대)
- places (장소) - 메인 테이블
- place_time_slots (장소-시간대 연결)
- place_images (장소 이미지)
- user_roles (사용자 역할) - 추후 추가
```

#### 3. 인증 시스템 구현
- **Supabase Auth 연동** (`app/lib/auth.server.ts`, `app/lib/supabase.server.ts`)
- **로그인/회원가입 페이지** (`app/routes/auth.login.tsx`, `app/routes/auth.signup.tsx`)
- **세션 관리** 및 쿠키 기반 인증
- **로그인 리다이렉트 문제 해결**: `redirectTo` 파라미터 처리

#### 4. 관리자 기능 구현
- **관리자 권한 시스템** (`app/lib/admin.server.ts`)
- **관리자 대시보드** (`app/routes/admin._index.tsx`)
  - 통계 카드 (총 장소 수, 활성 장소 수, 제휴 업체 수)
  - 한국어 UI 및 직관적인 네비게이션
- **장소 관리 시스템**
  - 장소 목록 페이지 (`app/routes/admin.places._index.tsx`)
  - 장소 추가 페이지 (`app/routes/admin.places.new.tsx`)
  - 장소 상세/수정 페이지 (`app/routes/admin.places.$id.tsx`)
- **CRUD 기능 완성**: 생성, 조회, 수정, 삭제

#### 5. 주요 해결 과제
- **로그인 후 리다이렉트 문제**: `redirectTo` 파라미터 및 세션 처리 개선
- **쿠키 세션 지속성 문제**: `createSupabaseServerClient` 응답 헤더 처리
- **보안 강화**: `getSession()` → `getUser()` 변경

### B 단계: 사용자 입력 폼 구현 ✅

#### 1. 추천 시스템 기반 구조
- **추천 로직 서버 함수** (`app/lib/recommendation.server.ts`)
- **지역, 시간대 데이터 조회** 기능 구현

#### 2. 사용자 인터페이스 개선
- **메인 페이지 개선** (`app/routes/_index.tsx`)
  - 비로그인 사용자: 랜딩 페이지 (로그인/회원가입 버튼)
  - 로그인 사용자: 추천 요청 폼
- **추천 요청 폼 구현**
  - 지역 선택 드롭다운 (6개 지역)
  - 날짜 선택 (오늘 이후만 선택 가능)
  - 시간대 다중 선택 (체크박스)
  - 폼 검증 및 오류 처리

#### 3. 추천 결과 표시
- **카드 그리드 레이아웃**으로 장소 정보 표시
- **카테고리 아이콘, 평점, 가격대, 태그** 표시
- **빈 결과 상태** 메시지 처리

#### 4. 기술적 개선사항
- **Chrome DevTools 404 오류 해결**: 캐치올 라우트 (`app/routes/$.tsx`) 추가
- **사용자 경험 개선**: 로딩 상태, 에러 핸들링

### 관리자 권한 시스템 구현 ✅

#### 1. 데이터베이스 스키마 확장
- **`user_roles` 테이블 추가**
  - 사용자별 역할 관리 (admin/user)
  - RLS(Row Level Security) 정책 적용
  - 인덱스 및 트리거 설정

#### 2. 권한 확인 로직
- **`requireAdmin()`**: 관리자 페이지 접근 시 권한 확인
- **`isAdmin()`**: UI 조건부 표시용 권한 확인
- **RLS 정책 순환 참조 문제 해결**

#### 3. UI 조건부 표시
- **관리자만 "관리자" 버튼 표시**
- **일반 사용자는 관리자 기능 접근 불가**

#### 4. 로컬 개발 환경 구축
- **Supabase CLI 설치** 및 로컬 인스턴스 구성
- **마이그레이션 시스템** 구축
- **시드 데이터** 자동 생성

## 🎯 구현된 주요 기능

### 👤 사용자 기능
- [x] 회원가입 / 로그인 / 로그아웃
- [x] 지역별 데이트 코스 추천 요청
- [x] 시간대별 맞춤 추천
- [x] 추천 결과 카드 형태로 표시

### 🔧 관리자 기능
- [x] 관리자 대시보드 (통계 정보)
- [x] 장소 관리 (CRUD)
- [x] 지역/카테고리/시간대 관리
- [x] 사용자 역할 관리
- [x] 제휴 업체 설정

### 🛡️ 보안 및 권한
- [x] Supabase Auth 기반 인증
- [x] 역할 기반 접근 제어 (RBAC)
- [x] RLS 정책으로 데이터 보안
- [x] 세션 관리 및 자동 로그아웃

## 📊 데이터베이스 현황

### 테이블 구조
- **regions**: 6개 지역 (성수동, 광명, 강남, 홍대, 이태원, 명동)
- **categories**: 7개 카테고리 (카페, 음식점, 산책로, 펍/바, 문화시설, 쇼핑, 액티비티)
- **time_slots**: 4개 시간대 (점심, 오후, 저녁, 밤)
- **places**: 3개 샘플 장소 (성수동 기준)
- **user_roles**: 관리자 권한 관리

### 샘플 데이터
1. **블루보틀 커피 성수점** (카페, 평점 4.3)
2. **언더스탠드 에비뉴** (쇼핑, 평점 4.1)  
3. **한강공원 뚝섬유원지** (산책로, 평점 4.5)

## 🐛 해결된 주요 이슈

### 1. 인증 관련 문제
- **문제**: 로그인 후 관리자 페이지 접근 시 홈으로 리다이렉트
- **해결**: `redirectTo` 파라미터 처리 및 세션 헤더 설정

### 2. RLS 정책 순환 참조
- **문제**: `user_roles` 테이블 조회 시 무한 재귀 오류
- **해결**: 정책 구조 변경 및 `service_role` 활용

### 3. Chrome DevTools 404 오류
- **문제**: 개발 중 DevTools 요청으로 인한 404 오류 로그
- **해결**: 캐치올 라우트로 조용히 처리

## 📈 성과 및 통계

### 개발 진행률
- **A 단계 (관리자 페이지)**: 100% 완료 ✅
- **B 단계 (사용자 입력 폼)**: 100% 완료 ✅
- **권한 시스템**: 100% 완료 ✅
- **전체 진행률**: 약 60% (C 단계 남음)

### 코드 통계
- **총 파일 수**: 약 25개
- **주요 라우트**: 10개
- **서버 함수**: 15개
- **데이터베이스 테이블**: 7개

### Git 커밋 기록
1. `feat: A 단계 관리자 페이지 구현 완료`
2. `fix: 로그인 리다이렉트 및 세션 문제 해결`
3. `feat: B 단계 사용자 입력 폼 및 추천 시스템 구현`
4. `feat: 관리자 권한 시스템 구현`
5. `fix: RLS 정책 순환 참조 문제 해결`

## 🔮 다음 단계 (C 단계) 계획

### 1. 고급 추천 알고리즘
- 거리 기반 추천 로직
- 평점 가중치 시스템
- 제휴 업체 우선 노출
- 카테고리 다양성 보장

### 2. 지도 통합
- Kakao Map API 연동
- 장소 마커 표시
- 경로 및 거리 계산
- 이동 시간 예측

### 3. 사용자 경험 개선
- 코스 자동 생성
- 필터링 기능
- 즐겨찾기 시스템
- 리뷰 및 평점 시스템

## 💡 배운 점 및 개선사항

### 기술적 학습
- **Remix의 서버 사이드 렌더링** 활용법
- **Supabase RLS 정책** 설계 및 디버깅
- **TypeScript 타입 안전성** 확보 방법
- **인증 시스템** 구현 베스트 프랙티스

### 개선 필요 사항
- **에러 핸들링** 더 세밀하게 구현
- **로딩 상태** UI 개선
- **모바일 반응형** 디자인 최적화
- **성능 최적화** (이미지 로딩, 쿼리 최적화)

## 📝 참고 자료

- [Remix 공식 문서](https://remix.run/docs)
- [Supabase 공식 문서](https://supabase.com/docs)
- [Tailwind CSS 문서](https://tailwindcss.com/docs)
- [TypeScript 핸드북](https://www.typescriptlang.org/docs)

---

**다음 개발 일정**: C 단계 고급 기능 구현 (지도 통합 및 추천 알고리즘 고도화) 